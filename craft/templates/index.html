{#
 # Homepage template
 # ---------------
 #
 # When this template gets loaded, it will be because someone has accessed
 # http://yoursite.com/ (without any URI). Craft checks to see if you have
 # a Single section set to be the Homepage (as you do, by default), and
 # loads the section’s Template (this file). A special ‘entry’ variable
 # will already be set for you, assigned to the Homepage entry.
 #
 # It's worth noting that even if you didn't have a Homepage Single section,
 # as long as this template remains at craft/templates/index.html, it
 # would still be the one to get loaded when accessing http://yoursite.com/,
 # albeit without an ‘entry’ variable already set for you.
 #
 # See this page for more details on how Craft routes requests:
 # http://buildwithcraft.com/docs/routing
 #}

{% extends "_layout" %}

{% set paramPerson = craft.request.getParam('person') %}
{% set paramTag = craft.request.getParam('tag') %}


{% if paramPerson == NULL %}
	{% set selectedPerson = craft.tags.groupBy('people') %}
{% else %}
	{% set selectedPerson = craft.tags.groupBy('people').slug(paramPerson).first() %}
{% endif %}

{% if paramTag == NULL %}
	{% set selectedTag = craft.tags.groupBy('default') %}
{% else %}
	{% set selectedTag = craft.tags.groupBy('default').slug(paramTag).first() %}
{% endif %}

{% set selectedReasons = craft.entries.section('reasons').relatedTo( 'and', {targetElement: selectedTag }, {targetElement: selectedPerson }) %}

{% block content %}

	{% if paramPerson != NULL or paramTag != NULL  %}

		<div id="results">

			<div class="container">

				{% if paramTag != NULL %}
		
					<h2>Reasons tagged with: <span class="colorize">{{ selectedTag.title }}</span></h2>

				{% endif %}

				{% if paramPerson != NULL %}
		
					<h2>Reasons by: <span class="colorize">{{ selectedPerson.title }}</span></h2>

				{% endif %}


			</div>

		</div>

	{% endif %}

	<div class="container">

		<ul class="reasons" id="reasons">

		{% if selectedReasons|length %}

			{% for reason in selectedReasons|reverse %}
				<li id="reason{{loop.index}}" class="wow fadeIn reason {% if loop.last %}no-border{% endif %}">

				    <h3>Reason {{ loop.index }}</h3>
				    
				    {{ reason.body }}

					{% for person in reason.person %}
					    {% if loop.first %}{% endif %}<a href="{{ siteUrl }}?person={{ person.slug }}#results" class="person">{{ person }}</a>{{ not loop.last ? ', ' }}
					{% endfor %}

				    <span class="tags">
				    	<strong>Tags: </strong>
				    	{% for tag in reason.tags %}
						    <a href="{{ siteUrl }}?tag={{ tag.slug }}#results" class="tag">{{ tag }}</a>
				    	{% endfor %}
					</span>

				</li>

			{% endfor %}
		{% else %}
			
			<li>No reasons found with the specified tag.</li>

		{% endif %}

		</ul>

	</div>

{% endblock %}